# NDR-Suricata-Zeek-ELK-MachineLearning

## 1. Introduction
**Objectives**
- Develop an Elastic dashboard (Elasticsearch, Kibana) to visualize abnormal traffic patterns and log-based alerts, enabling timely detection, response, and post-incident investigation and evaluation.
- Build an NDR (Network Detection and Response) system using open-source, free, and user-friendly resources.
- Integrate Suricata and Zeek—two powerful open-source tools—alongside the Elastic framework (Filebeat, Elasticsearch, Kibana) to support data visualization. This cost-effective yet highly efficient solution is well-suited even for small and medium-sized enterprises. Additionally, incorporate a custom-developed AI-based IDS (Intrusion Detection System).
- Design a system architecture centered around a core switch, ensuring all network traffic is routed through this device and mirrored to the NDR system. This solution allows seamless integration with various tools beyond just NDR and Elastic.
- Create scripts to interface with the core switch for applying IP blocking rules. Additionally, implement automated scripts to notify administrators via email alerts.

## 2. Business Requirements
1. **Scalability and Adaptability**:  The Elastic dashboard (Elasticsearch, Kibana) supports visualization and statistical analysis (e.g., timestamp, source, destination, rule.name) of alert and attack data aggregated from logs generated by Suricata, Zeek, and the custom AI-based IDS.
2. **Sophisticated Threat Detection**: It enables early and accurate detection of abnormal traffic and behaviors within the internal network, such as TCP SYN Flood (DoS), Reverse Shells, SQL Injection, and more.
3. **Short Latency Response**: As soon as logs are collected via Filebeat and ingested into Elasticsearch, automated scripts will filter and detect attack patterns based on the log data, block the corresponding source IPs, and send out alert notifications via email.
4. **Scalability and Adaptability**: Elasticsearch's ability to collect logs from various sources facilitates integration with multiple security tools, supporting seamless management and scalability.
5. **Operational Needs**: The NDR solution must be designed and implemented to minimize business disruption and allow easy integration into existing operational workflows.

## 3.Non-Business Requirements
1. **Infrastructure**: Minimum Hardware Requirements
- VM – NDR (Zeek & Suricata): 6GB RAM, 4 CPU cores
- VM – ELK Stack: 6GB RAM, 4 CPU cores
- Recommended OS: Ubuntu Server (20.04 LTS / 22.04 LTS)
- Essential tools: Suricata, Zeek, Filebeat, Elasticsearch, Kibana (latest versions), and relevant Python libraries

2. **Performance Expectations**:
- The system must process logs from Suricata and Zeek without exceeding 70% CPU utilization or 80% RAM usage under normal traffic load
- Capable of real-time processing of high-volume network traffic ranging from several hundred Mbps to multiple Gbps
- Threat detection latency should be under 3 seconds from the moment a suspicious packet is observed

3. **Log Retention and Storage Strategy**:
- Minimum log retention period: 12 months
- Hot Storage (7–30 days): Logs must be stored on high-speed storage for quick retrieval
- Warm Storage (1–3 months): Logs can be stored on slower disks, with acceptable access latency
- Cold Storage (3–12 months): Logs may be compressed and stored on low-speed devices; retrieval is slower but still suitable for forensic analysis or attack scope determination

## 4. Architecture
1. **Deploy Architecture**
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image6.png)

2. **Data Architecture**
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image7.png)

3. **IDS-AI Based Architecture**
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image8.png)

4. **Response WorkFlow**:
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image9.png)

5. **Functional Architecture**
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image45.jpg)

## 5. Test Scenarios
1. **Scenario 1: Detection of DoS/DDoS SYN Flood Attacks**
 - Detection Source: AI-based IDS
 - Objective: Validate the system's ability to identify and generate alerts for SYN flood patterns typically associated with denial-of-service (DoS/DDoS) attacks.
 - Attack Simulation: A simulated DoS attack is initiated from the attacker machine targeting the client machine using the hping3 tool to generate a SYN flood.
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image13.png)
   
 - Log Collection: After the attack is launched, log data is collected and forwarded to the Elastic Stack. The log entry source is identified as the IDS module, and the log file containing the relevant alert is named ddos_attack.json.
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image14.png)

 - Response Automation: Upon ingestion of the log, automated scripts are triggered:
 - The offending source IP is automatically blocked via a rule applied through the core switch.
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image15.png)
 - An email alert is sent to administrators notifying them of the detected threat and mitigation actions.
![imaeg](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image16.png)


2. **Scenario 2: Detection of Brute Force Attacks**
 - Detection Source: Suricata
 - Objective: Ensure successful identification of brute-force login attempts, particularly on common services such as SSH, FTP, or HTTP, based on signature-based alerts.
 - Attack Simulation: The attacker machine executes a password brute force attack targeting the login page of DVWA (Damn Vulnerable Web Application) using a tool such as hydra or a custom python script.
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image25.png)

 - Log Generation & Ingestion: The attack traffic is detected by Suricata, which generates IDS alerts. These logs are collected and shipped via Filebeat to Elasticsearch, where they are indexed. The log entries are visualized in Kibana.
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image26.png)
  
 - Automated Response:
 - Block the attacking IP address by applying a rule via the core switch interface
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image28.png)
   
 - Send an email alert to the administrator detailing the event and mitigation step
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image27.png)
   
3. **Scenario 3: Detection of Potential Data Exfiltration Activities**
 - Detection Source: Zeek
 - Objective: Detect abnormal outbound connections or unusual data transfer behaviors that may indicate data exfiltration from within the internal network.
 - Server Setup (Attacker Side): A simple HTTP server is built using Flask on the attacker machine, listening on port 5000, to simulate an external data receiver.
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image30.png)
  
 - File Transfer (Client Side): On the internal client machine, a file approximately 55 MB in size is created and then uploaded to the attacker’s Flask server via HTTP POST or similar method.
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image31.png)
  
 - Log Collection and Visualization: Network activity is monitored using Zeek, which identifies the unusual file transfer. Logs are captured and forwarded to Elasticsearch via Filebeat, and the event is visualized in Kibana.
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image32.png)
  
 - Automated Script Actions:
 - Blocks the destination IP to halt ongoing data transfer:
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image33.png)
   
 - Sends an email alert to system administrators detailing the incident, including timestamps, source IP, file size, and destination server info:
![image](https://github.com/grapitycreation/NDR-Suricata-Zeek-ELK-MachineLearning/blob/main/Images/image34.png)

















